---
name: "Deploy"

on:
  push:
    branches:
      - main

concurrency:
  # Concurrency control scoped to branch-workflow
  group: deploy-prod-${{ github.ref }}
  cancel-in-progress: true

permissions:
  id-token: write
  contents: write
  pull-requests: write
  deployments: write

jobs:
  deploy-prod:
    uses: ./.github/workflows/deploy.yml
    with:
      stage: prod
      domain: metal-fests.com
    secrets:
      DEPLOY_ROLE_ARN: ${{ secrets.DEPLOY_ROLE_ARN }}
      CLOUDFRONT_DISTRIBUTION_ID: ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
